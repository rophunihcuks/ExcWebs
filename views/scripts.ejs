<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ExHub — Supported Games</title>
  <link rel="icon" type="image/png" href="/img/ExLogo2.png" />
  <link rel="stylesheet" href="/css/main.css" />
</head>
<body class="page-dark">

<header class="site-header">
  <div class="container header-inner">
    <a href="/" class="logo">
      <span class="logo-icon">
        <img src="/img/ExLogo2.png" alt="ExHub Logo" style="width:100%;height:100%;object-fit:cover;border-radius:12px;" />
      </span>
      <span class="logo-text">ExHub</span>
    </a>
    <nav class="nav-links">
      <a href="/">Home</a>
      <a href="/scripts" class="nav-active">Scripts</a>
      <!-- <a href="/get-key">Get Key Work.Ink</a> -->
      <!-- <a href="/generatekey">Get Key Linkvertise</a> -->
      <a href="https://discord.com/invite/VsFQq5s6" target="_blank">Discord</a>
      <a href="/discord-login" class="nav-pill">Get Free Key</a> 
      <!-- <a href="/admin/login" class="nav-pill">Login</a> -->
    </nav>
  </div>
</header>

<main class="section">
  <div class="container">
    <h1 class="section-title">ExHub <span class="accent-cycle">Supported Scripts</span></h1>
    <p class="section-subtitle">
      Browse our collection of premium scripts. Semua script di-review dan di-update secara berkala.
    </p>

    <div class="stats-row">
      <div class="stat-item">
        <span class="stat-label">Supported Games</span>
        <span class="stat-value" id="stat-total-games"><%= stats.totalGames %></span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Total Executions</span>
        <span class="stat-value" id="stat-total-executions"><%= stats.totalExecutions %></span>
      </div>
      <div class="stat-item">
        <span class="stat-label">Users Count</span>
        <span class="stat-value" id="stat-total-users"><%= stats.totalUsers %></span>
      </div>
    </div>

    <div class="scripts-grid">
      <% if (scripts.length === 0) { %>
        <p>Tidak ada script yang terdaftar.</p>
      <% } %>

      <% scripts.forEach(function(script) { %>
        <article class="script-card" data-script-id="<%= script.id %>">
          <% if (script.thumbnail) { %>
            <div class="script-thumb" style="background-image:url('<%= script.thumbnail %>')"></div>
          <% } %>
          <div class="script-body">
            <div class="script-top">
              <h3><%= script.name %></h3>
              <span class="badge version"><%= script.version %></span>
            </div>
            <p class="script-game"><%= script.gameName %></p>
            <p class="script-desc"><%= script.shortDescription || '' %></p>

            <div class="script-meta">
              <span class="badge <%= script.isFree ? 'badge-free' : 'badge-paid' %>">
                <%= script.isFree ? 'Free' : 'Paid' %>
              </span>
              <span class="badge status-<%= script.status %>">
                <%= script.status === 'working' ? 'Working' : script.status %>
              </span>
            </div>

            <div class="script-stats-row">
              <div>
                <span class="stat-label">Uses</span>
                <span class="stat-value script-uses"><%= script.uses || 0 %></span>
              </div>
              <div>
                <span class="stat-label">Users</span>
                <span class="stat-value script-users"><%= script.users || 0 %></span>
              </div>
            </div>

            <div class="script-actions">
              <!-- Copy Loader: loader disesuaikan per-id script -->
              <button
                class="btn-primary btn-small copy-loader-btn"
                type="button"
                data-loader='loadstring(game:HttpGet("https://excc-webs.vercel.app/api/script/<%= script.id %>", true))()'
              >
                Copy Loader
              </button>

              <!-- Tombol Discord -->
              <a
                href="https://discord.com/invite/VsFQq5s6"
                target="_blank"
                class="btn-ghost btn-small"
              >
                Discord
              </a>
            </div>
          </div>
        </article>
      <% }) %>
    </div>

    <section class="section section-muted">
      <h2 class="section-title small">Can't find your game?</h2>
      <p class="section-subtitle">
        Request game favorit Anda dan tim akan mengembangkan script khusus.
      </p>
      <a href="https://discord.com/invite/VsFQq5s6" target="_blank" class="btn-primary">
        Request via Discord
      </a>
    </section>
  </div>
</main>

<footer class="site-footer">
  <div class="container footer-grid">
    <div>
      <div class="logo">
        <span class="logo-icon">
          <img src="/img/ExLogo2.png" alt="ExHub Logo" style="width:100%;height:100%;object-fit:cover;border-radius:12px;" />
        </span>
      </div>
      <p class="footer-copy">© <%= new Date().getFullYear() %> ExHub.</p>
    </div>
  </div>
</footer>

<!-- Copy Loader + Live Stats -->
<script>
  // === COPY LOADER BUTTONS ==========================================
  (function () {
    const buttons = document.querySelectorAll('.copy-loader-btn');

    function setStatus(btn, text) {
      const original = btn.dataset.originalText || 'Copy Loader';
      if (!btn.dataset.originalText) {
        btn.dataset.originalText = original;
      }
      btn.textContent = text;
      btn.disabled = true;
      setTimeout(function () {
        btn.textContent = btn.dataset.originalText;
        btn.disabled = false;
      }, 1500);
    }

    function fallbackCopy(text, btn) {
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();
      try {
        document.execCommand('copy');
        setStatus(btn, 'Copied!');
      } catch (err) {
        console.error('Copy failed', err);
        setStatus(btn, 'Copy failed');
      }
      document.body.removeChild(textarea);
    }

    buttons.forEach(function (btn) {
      btn.addEventListener('click', function () {
        const loader = btn.getAttribute('data-loader');
        if (!loader) return;

        if (navigator.clipboard && navigator.clipboard.writeText) {
          navigator.clipboard
            .writeText(loader)
            .then(function () {
              setStatus(btn, 'Copied!');
            })
            .catch(function () {
              fallbackCopy(loader, btn);
            });
        } else {
          fallbackCopy(loader, btn);
        }
      });
    });
  })();

  // === LIVE UPDATE STATS (USES / USERS / TOTAL) ======================
  (function () {
    async function refreshStats() {
      try {
        const res = await fetch('/api/stats');
        if (!res.ok) return;
        const data = await res.json();

        // update total stats
        if (data.stats) {
          const g = document.getElementById('stat-total-games');
          const e = document.getElementById('stat-total-executions');
          const u = document.getElementById('stat-total-users');
          if (g) g.textContent = data.stats.totalGames;
          if (e) e.textContent = data.stats.totalExecutions;
          if (u) u.textContent = data.stats.totalUsers;
        }

        // update tiap card script
        if (Array.isArray(data.scripts)) {
          data.scripts.forEach(function (s) {
            const card = document.querySelector('[data-script-id="' + s.id + '"]');
            if (!card) return;
            const usesEl = card.querySelector('.script-uses');
            const usersEl = card.querySelector('.script-users');
            if (usesEl) usesEl.textContent = s.uses || 0;
            if (usersEl) usersEl.textContent = s.users || 0;
          });
        }
      } catch (err) {
        console.error('Failed to refresh stats on scripts page:', err);
      }
    }

    // panggil sekali saat load, lalu interval 10 detik
    refreshStats();
    setInterval(refreshStats, 10000);
  })();
</script>

<!-- Proteksi dasar: blokir klik kanan + beberapa shortcut DevTools -->
<script src="/js/protect-devtools.js"></script>

</body>
</html>
